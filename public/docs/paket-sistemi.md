# ğŸ“¦ Ã‡izimo Paket (Abonelik) Sistemi DokÃ¼mantasyonu

## Genel BakÄ±ÅŸ

Ã‡izimo, Ã§ocuklar iÃ§in kiÅŸiselleÅŸtirilmiÅŸ hikaye oluÅŸturma platformudur. 4 farklÄ± abonelik paketi sunmaktadÄ±r.

---

## Paket Seviyeleri

### ğŸ£ Minik Masal (BaÅŸlangÄ±Ã§ Paketi)
- **AylÄ±k Fiyat:** 49 TL
- **AylÄ±k Hikaye HakkÄ±:** 1
- **Maksimum Sayfa:** 5
- **Ã‡ocuk Profili:** 1
- **Deneme SÃ¼resi:** Ä°lk 3 ay Ã¼cretsiz

**Ã–zellikler:**
- âœ… Temel kiÅŸiselleÅŸtirme (ad, yaÅŸ)

---

### ğŸ¿ï¸ Masal KeÅŸifÃ§isi
- **AylÄ±k Fiyat:** 199 TL
- **AylÄ±k Hikaye HakkÄ±:** 3
- **Maksimum Sayfa:** 15
- **Ã‡ocuk Profili:** 2

**Ã–zellikler (Minik Masal + Ek):**
- âœ… Temel kiÅŸiselleÅŸtirme (ad, yaÅŸ)
- âœ… GeliÅŸmiÅŸ kiÅŸiselleÅŸtirme
- âœ… Kapak tasarÄ±mÄ± seÃ§imi
- âœ… ArkadaÅŸla paylaÅŸma
- âœ… Basit istatistik

---

### ğŸ¦„ Masal KahramanÄ±
- **AylÄ±k Fiyat:** 499 TL
- **AylÄ±k Hikaye HakkÄ±:** 10
- **Maksimum Sayfa:** 20
- **Ã‡ocuk Profili:** 3

**Ã–zellikler (Masal KeÅŸifÃ§isi + Ek):**
- âœ… TÃ¼m Masal KeÅŸifÃ§isi Ã¶zellikleri
- âœ… DetaylÄ± istatistik
- âœ… FotoÄŸraftan hikaye
- âœ… Sesli hikaye (AI anlatÄ±cÄ±)
- âœ… YazÄ± tipi seÃ§imi
- âœ… SÄ±nÄ±rsÄ±z revizyon
- âœ… Favori sayfa iÅŸaretleme

---

### ğŸ‰ Sonsuz Masal DÃ¼nyasÄ± (Premium)
- **AylÄ±k Fiyat:** 999 TL
- **AylÄ±k Hikaye HakkÄ±:** SÄ±nÄ±rsÄ±z
- **Maksimum Sayfa:** SÄ±nÄ±rsÄ±z
- **Ã‡ocuk Profili:** 5

**Ã–zellikler (TÃ¼m Ã–zellikler):**
- âœ… TÃ¼m Masal KahramanÄ± Ã¶zellikleri
- âœ… SÄ±nÄ±rsÄ±z arkadaÅŸ paylaÅŸÄ±mÄ±
- âœ… GeliÅŸmiÅŸ istatistik
- âœ… Ã–zel illÃ¼strasyon stili
- âœ… HaftalÄ±k tema koleksiyonu
- âœ… Aile iÃ§i paylaÅŸÄ±m
- âœ… BaskÄ±ya hazÄ±r tasarÄ±m
- âœ… KÃ¼tÃ¼phane yedekleme

---

## Ã–zellik KarÅŸÄ±laÅŸtÄ±rma Tablosu

| Ã–zellik | Minik Masal | Masal KeÅŸifÃ§isi | Masal KahramanÄ± | Sonsuz Masal |
|---------|:-----------:|:---------------:|:---------------:|:------------:|
| **Fiyat (TL/ay)** | 49 | 199 | 499 | 999 |
| **AylÄ±k Hikaye** | 1 | 3 | 10 | SÄ±nÄ±rsÄ±z |
| **Maks. Sayfa** | 5 | 15 | 20 | SÄ±nÄ±rsÄ±z |
| **Ã‡ocuk Profili** | 1 | 2 | 3 | 5 |
| Temel kiÅŸiselleÅŸtirme | âœ… | âœ… | âœ… | âœ… |
| GeliÅŸmiÅŸ kiÅŸiselleÅŸtirme | âŒ | âœ… | âœ… | âœ… |
| Kapak tasarÄ±mÄ± seÃ§imi | âŒ | âœ… | âœ… | âœ… |
| ArkadaÅŸla paylaÅŸma | âŒ | âœ… | âœ… | âœ… |
| SÄ±nÄ±rsÄ±z arkadaÅŸ paylaÅŸÄ±mÄ± | âŒ | âŒ | âŒ | âœ… |
| Basit istatistik | âŒ | âœ… | âœ… | âœ… |
| DetaylÄ± istatistik | âŒ | âŒ | âœ… | âœ… |
| GeliÅŸmiÅŸ istatistik | âŒ | âŒ | âŒ | âœ… |
| FotoÄŸraftan hikaye | âŒ | âŒ | âœ… | âœ… |
| Sesli hikaye (AI anlatÄ±cÄ±) | âŒ | âŒ | âœ… | âœ… |
| YazÄ± tipi seÃ§imi | âŒ | âŒ | âœ… | âœ… |
| SÄ±nÄ±rsÄ±z revizyon | âŒ | âŒ | âœ… | âœ… |
| Favori sayfa iÅŸaretleme | âŒ | âŒ | âœ… | âœ… |
| Ã–zel illÃ¼strasyon stili | âŒ | âŒ | âŒ | âœ… |
| HaftalÄ±k tema koleksiyonu | âŒ | âŒ | âŒ | âœ… |
| Aile iÃ§i paylaÅŸÄ±m | âŒ | âŒ | âŒ | âœ… |
| BaskÄ±ya hazÄ±r tasarÄ±m | âŒ | âŒ | âŒ | âœ… |
| KÃ¼tÃ¼phane yedekleme | âŒ | âŒ | âŒ | âœ… |

---

## Teknik AltyapÄ±

### VeritabanÄ± TablolarÄ±

#### 1. `subscriptions` (KullanÄ±cÄ± Abonelikleri)
```sql
- id: UUID (Primary Key)
- user_id: UUID (KullanÄ±cÄ± ID)
- tier: subscription_tier (Paket seviyesi)
- monthly_credits: INTEGER (AylÄ±k hikaye hakkÄ±, -1 = sÄ±nÄ±rsÄ±z)
- used_credits: INTEGER (KullanÄ±lan kredi)
- max_pages: INTEGER (Maksimum sayfa, -1 = sÄ±nÄ±rsÄ±z)
- max_children: INTEGER (Maksimum Ã§ocuk profili)
- price_tl: INTEGER (AylÄ±k fiyat TL)
- trial_ends_at: TIMESTAMP (Deneme sÃ¼resi bitiÅŸ tarihi)
- current_period_start: TIMESTAMP (DÃ¶nem baÅŸlangÄ±cÄ±)
- current_period_end: TIMESTAMP (DÃ¶nem bitiÅŸi)
- created_at: TIMESTAMP
- updated_at: TIMESTAMP
```

#### 2. `subscription_features` (Paket Ã–zellikleri)
```sql
- id: UUID (Primary Key)
- tier: subscription_tier (Paket seviyesi)
- monthly_credits: INTEGER
- max_pages: INTEGER
- max_children: INTEGER
- price_tl: INTEGER
- trial_months: INTEGER (Deneme sÃ¼resi ay)
- basic_personalization: BOOLEAN
- advanced_personalization: BOOLEAN
- cover_design_selection: BOOLEAN
- friend_sharing: BOOLEAN
- unlimited_friend_sharing: BOOLEAN
- basic_stats: BOOLEAN
- detailed_stats: BOOLEAN
- advanced_stats: BOOLEAN
- photo_story: BOOLEAN
- audio_story: BOOLEAN
- font_selection: BOOLEAN
- unlimited_revision: BOOLEAN
- favorite_pages: BOOLEAN
- custom_illustration: BOOLEAN
- weekly_themes: BOOLEAN
- family_sharing: BOOLEAN
- print_ready: BOOLEAN
- library_backup: BOOLEAN
- unlimited_stories: BOOLEAN
- unlimited_pages: BOOLEAN
```

### Enum TanÄ±mlarÄ±
```sql
CREATE TYPE subscription_tier AS ENUM (
  'minik_masal',
  'masal_kesfifcisi', 
  'masal_kahramani',
  'sonsuz_masal'
);
```

---

## Kredi Sistemi

### NasÄ±l Ã‡alÄ±ÅŸÄ±r?
1. Her paket aylÄ±k belirli sayÄ±da hikaye kredisi saÄŸlar
2. Hikaye oluÅŸturulduÄŸunda `used_credits` artar
3. DÃ¶nem sonunda (current_period_end) krediler sÄ±fÄ±rlanÄ±r
4. `-1` deÄŸeri sÄ±nÄ±rsÄ±z anlamÄ±na gelir

### VeritabanÄ± FonksiyonlarÄ±

```sql
-- Kalan kredi sorgulama
SELECT get_remaining_credits(_user_id);

-- Hikaye oluÅŸturabilir mi kontrolÃ¼
SELECT can_create_story(_user_id);

-- Kredi kullanma
SELECT use_story_credit(_user_id);

-- KullanÄ±cÄ± paket seviyesi
SELECT get_user_tier(_user_id);
```

---

## Frontend Hook: useSubscription()

```typescript
const {
  subscription,           // Aktif abonelik
  currentFeatures,        // Mevcut paket Ã¶zellikleri
  allFeatures,           // TÃ¼m paket Ã¶zellikleri
  remainingCredits,      // Kalan kredi (-1 = sÄ±nÄ±rsÄ±z)
  isInTrial,             // Deneme sÃ¼resinde mi?
  canCreateStory,        // Hikaye oluÅŸturabilir mi?
  getMaxPages,           // Ä°zin verilen sayfa sayÄ±sÄ±
  hasFeature,            // Ã–zellik kontrolÃ¼
  maxChildren,           // Maks Ã§ocuk profili
  useCredit,             // Kredi kullan
  changeTier,            // Paket deÄŸiÅŸtir
  tierName,              // Paket adÄ± (gÃ¶rÃ¼ntÃ¼leme iÃ§in)
  tierEmoji,             // Paket emojisi
} = useSubscription();
```

### KullanÄ±m Ã–rnekleri

```typescript
// Ã–zellik kontrolÃ¼
if (hasFeature('audio_story')) {
  // Sesli hikaye Ã¶zelliÄŸi aktif
}

// Kredi kontrolÃ¼
if (canCreateStory) {
  // Hikaye oluÅŸturulabilir
}

// Sayfa limiti kontrolÃ¼
const allowedPages = getMaxPages(requestedPageCount);
```

---

## RLS (Row Level Security) PolitikalarÄ±

### subscriptions tablosu
- **SELECT:** KullanÄ±cÄ± sadece kendi aboneliÄŸini gÃ¶rebilir
- **INSERT:** KullanÄ±cÄ± kendi aboneliÄŸini oluÅŸturabilir
- **UPDATE:** KullanÄ±cÄ± veya admin gÃ¼ncelleyebilir
- **DELETE:** Ä°zin verilmez

### subscription_features tablosu
- **SELECT:** Herkes gÃ¶rebilir (public)
- **INSERT/UPDATE/DELETE:** Ä°zin verilmez (admin only)

---

## Yeni KullanÄ±cÄ± AkÄ±ÅŸÄ±

1. KullanÄ±cÄ± kayÄ±t olur
2. Otomatik olarak "minik_masal" paketi atanÄ±r
3. 3 aylÄ±k Ã¼cretsiz deneme sÃ¼resi baÅŸlar
4. Deneme sÃ¼resi bitiminde Ã¶deme gerekir

---

## Paket YÃ¼kseltme/DÃ¼ÅŸÃ¼rme

- Paket deÄŸiÅŸikliÄŸi anÄ±nda uygulanÄ±r
- Krediler sÄ±fÄ±rlanÄ±r
- Yeni paket limitleri geÃ§erli olur
- Ã–deme entegrasyonu henÃ¼z mevcut deÄŸil (TODO)

---

## Notlar

- Admin kullanÄ±cÄ±lar tÃ¼m Ã¶zelliklere sÄ±nÄ±rsÄ±z eriÅŸime sahiptir
- Kredi sistemi `use_story_credit()` fonksiyonu ile yÃ¶netilir
- Ã–deme entegrasyonu (Stripe/iyzico) ileride eklenecektir

---

*Son gÃ¼ncelleme: Ocak 2026*
